

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Set-Operations with Overlay &#8212; GeoPandas 0.8.1 documentation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/jupyter-sphinx.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/mystnb.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Aggregation with dissolve" href="aggregation_with_dissolve.html" />
    <link rel="prev" title="Geometric Manipulations" href="geometric_manipulations.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    
    <a class="navbar-brand" href="../../index.html">
      <img src="../../_static/geopandas_logo.svg" class="logo" alt="logo">
    </a>
    
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../../index.html">Home</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../about.html">About</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../getting_started.html">Getting started</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="../../docs.html">Documentation</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../../community.html">Community</a>
        </li>
        
        
      </ul>


      

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/geopandas/geopandas" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
          <li class="nav-item">
            <a class="nav-link" href="https://twitter.com/geopandas" target="_blank" rel="noopener">
              <span><i class="fab fa-twitter-square"></i></span>
            </a>
          </li>
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar">

<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>


<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

  <div class="bd-toc-item active">
  

  <ul class="nav bd-sidenav">
      
      
      
      
      
      
      
      
        
          

              <li class="active">
                  <a href="../user_guide.html">User Guide</a>
                  <ul>
                  
                      <li class="">
                          <a href="data_structures.html">Data Structures</a>
                      </li>
                  
                      <li class="">
                          <a href="io.html">Reading and Writing Files</a>
                      </li>
                  
                      <li class="">
                          <a href="indexing.html">Indexing and Selecting Data</a>
                      </li>
                  
                      <li class="">
                          <a href="mapping.html">Making Maps</a>
                      </li>
                  
                      <li class="">
                          <a href="projections.html">Managing Projections</a>
                      </li>
                  
                      <li class="">
                          <a href="geometric_manipulations.html">Geometric Manipulations</a>
                      </li>
                  
                      <li class="active">
                          <a href="">Set Operations with overlay</a>
                      </li>
                  
                      <li class="">
                          <a href="aggregation_with_dissolve.html">Aggregation with dissolve</a>
                      </li>
                  
                      <li class="">
                          <a href="mergingdata.html">Merging Data</a>
                      </li>
                  
                      <li class="">
                          <a href="geocoding.html">Geocoding</a>
                      </li>
                  
                      <li class="">
                          <a href="missing_empty.html">Missing and empty geometries</a>
                      </li>
                  
                  </ul>
              </li>
          
        
          
              <li class="">
                  <a href="../reference.html">API reference</a>
              </li>
          
        
          
              <li class="">
                  <a href="../changelog.html">Changelog</a>
              </li>
          
        
      
      
      
      
    </ul>

</nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#the-different-overlay-operations" class="nav-link">The different Overlay operations</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#overlay-countries-example" class="nav-link">Overlay Countries Example</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#keep-geom-type-keyword" class="nav-link">keep_geom_type keyword</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#more-examples" class="nav-link">More Examples</a>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div class="section" id="set-operations-with-overlay">
<h1>Set-Operations with Overlay<a class="headerlink" href="#set-operations-with-overlay" title="Permalink to this headline">¶</a></h1>
<p>When working with multiple spatial datasets – especially multiple <em>polygon</em> or
<em>line</em> datasets – users often wish to create new shapes based on places where
those datasets overlap (or don’t overlap). These manipulations are often
referred using the language of sets – intersections, unions, and differences.
These types of operations are made available in the <em>geopandas</em> library through
the <code class="docutils literal notranslate"><span class="pre">overlay</span></code> function.</p>
<p>The basic idea is demonstrated by the graphic below but keep in mind that
overlays operate at the DataFrame level, not on individual geometries, and the
properties from both are retained. In effect, for every shape in the first
GeoDataFrame, this operation is executed against every other shape in the other
GeoDataFrame:</p>
<img alt="../../_images/overlay_operations.png" src="../../_images/overlay_operations.png" />
<p><strong>Source: QGIS Documentation</strong></p>
<p>(Note to users familiar with the <em>shapely</em> library: <code class="docutils literal notranslate"><span class="pre">overlay</span></code> can be thought
of as offering versions of the standard <em>shapely</em> set-operations that deal with
the complexities of applying set operations to two <em>GeoSeries</em>. The standard
<em>shapely</em> set-operations are also available as <code class="docutils literal notranslate"><span class="pre">GeoSeries</span></code> methods.)</p>
<div class="section" id="the-different-overlay-operations">
<h2>The different Overlay operations<a class="headerlink" href="#the-different-overlay-operations" title="Permalink to this headline">¶</a></h2>
<p>First, we create some example data:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Polygon</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">polys1</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">([</span><span class="n">Polygon</span><span class="p">([(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)]),</span>
   <span class="o">...</span><span class="p">:</span>                               <span class="n">Polygon</span><span class="p">([(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)])])</span>
   <span class="o">...</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">polys2</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoSeries</span><span class="p">([</span><span class="n">Polygon</span><span class="p">([(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)]),</span>
   <span class="o">...</span><span class="p">:</span>                               <span class="n">Polygon</span><span class="p">([(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">)])])</span>
   <span class="o">...</span><span class="p">:</span> 

<span class="n">In</span> <span class="p">[</span><span class="mi">4</span><span class="p">]:</span> <span class="n">df1</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">({</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="n">polys1</span><span class="p">,</span> <span class="s1">&#39;df1&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]})</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">5</span><span class="p">]:</span> <span class="n">df2</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">GeoDataFrame</span><span class="p">({</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="n">polys2</span><span class="p">,</span> <span class="s1">&#39;df2&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]})</span>
</pre></div>
</div>
<p>These two GeoDataFrames have some overlapping areas:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">6</span><span class="p">]:</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">);</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">7</span><span class="p">]:</span> <span class="n">df2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">);</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/overlay_example.png"><img alt="../../_images/overlay_example.png" src="../../_images/overlay_example.png" style="width: 5in;" /></a>
<p>We illustrate the different overlay modes with the above example.
The <code class="docutils literal notranslate"><span class="pre">overlay</span></code> function will determine the set of all individual geometries
from overlaying the two input GeoDataFrames. This result covers the area covered
by the two input GeoDataFrames, and also preserves all unique regions defined by
the combined boundaries of the two GeoDataFrames.</p>
<p>When using <code class="docutils literal notranslate"><span class="pre">how='union'</span></code>, all those possible geometries are returned:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">8</span><span class="p">]:</span> <span class="n">res_union</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;union&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">9</span><span class="p">]:</span> <span class="n">res_union</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">9</span><span class="p">]:</span> 
   <span class="n">df1</span>  <span class="n">df2</span>                                           <span class="n">geometry</span>
<span class="mi">0</span>  <span class="mf">1.0</span>  <span class="mf">1.0</span>  <span class="n">POLYGON</span> <span class="p">((</span><span class="mf">1.000000000</span> <span class="mf">2.000000000</span><span class="p">,</span> <span class="mf">2.000000000</span><span class="o">...</span>
<span class="mi">1</span>  <span class="mf">2.0</span>  <span class="mf">1.0</span>  <span class="n">POLYGON</span> <span class="p">((</span><span class="mf">2.000000000</span> <span class="mf">2.000000000</span><span class="p">,</span> <span class="mf">2.000000000</span><span class="o">...</span>
<span class="mi">2</span>  <span class="mf">2.0</span>  <span class="mf">2.0</span>  <span class="n">POLYGON</span> <span class="p">((</span><span class="mf">3.000000000</span> <span class="mf">4.000000000</span><span class="p">,</span> <span class="mf">4.000000000</span><span class="o">...</span>
<span class="mi">3</span>  <span class="mf">1.0</span>  <span class="n">NaN</span>  <span class="n">POLYGON</span> <span class="p">((</span><span class="mf">0.000000000</span> <span class="mf">0.000000000</span><span class="p">,</span> <span class="mf">0.000000000</span><span class="o">...</span>
<span class="mi">4</span>  <span class="mf">2.0</span>  <span class="n">NaN</span>  <span class="n">MULTIPOLYGON</span> <span class="p">(((</span><span class="mf">2.000000000</span> <span class="mf">3.000000000</span><span class="p">,</span> <span class="mf">2.000</span><span class="o">...</span>
<span class="mi">5</span>  <span class="n">NaN</span>  <span class="mf">1.0</span>  <span class="n">MULTIPOLYGON</span> <span class="p">(((</span><span class="mf">1.000000000</span> <span class="mf">2.000000000</span><span class="p">,</span> <span class="mf">1.000</span><span class="o">...</span>
<span class="mi">6</span>  <span class="n">NaN</span>  <span class="mf">2.0</span>  <span class="n">POLYGON</span> <span class="p">((</span><span class="mf">3.000000000</span> <span class="mf">4.000000000</span><span class="p">,</span> <span class="mf">3.000000000</span><span class="o">...</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">10</span><span class="p">]:</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">res_union</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;tab10&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span> <span class="n">df1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">);</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span> <span class="n">df2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">);</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/overlay_example_union.png"><img alt="../../_images/overlay_example_union.png" src="../../_images/overlay_example_union.png" style="width: 5in;" /></a>
<p>The other <code class="docutils literal notranslate"><span class="pre">how</span></code> operations will return different subsets of those geometries.
With <code class="docutils literal notranslate"><span class="pre">how='intersection'</span></code>, it returns only those geometries that are contained
by both GeoDataFrames:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">13</span><span class="p">]:</span> <span class="n">res_intersection</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;intersection&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">14</span><span class="p">]:</span> <span class="n">res_intersection</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">14</span><span class="p">]:</span> 
   <span class="n">df1</span>  <span class="n">df2</span>                                           <span class="n">geometry</span>
<span class="mi">0</span>    <span class="mi">1</span>    <span class="mi">1</span>  <span class="n">POLYGON</span> <span class="p">((</span><span class="mf">1.000000000</span> <span class="mf">2.000000000</span><span class="p">,</span> <span class="mf">2.000000000</span><span class="o">...</span>
<span class="mi">1</span>    <span class="mi">2</span>    <span class="mi">1</span>  <span class="n">POLYGON</span> <span class="p">((</span><span class="mf">2.000000000</span> <span class="mf">2.000000000</span><span class="p">,</span> <span class="mf">2.000000000</span><span class="o">...</span>
<span class="mi">2</span>    <span class="mi">2</span>    <span class="mi">2</span>  <span class="n">POLYGON</span> <span class="p">((</span><span class="mf">3.000000000</span> <span class="mf">4.000000000</span><span class="p">,</span> <span class="mf">4.000000000</span><span class="o">...</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">15</span><span class="p">]:</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">res_intersection</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;tab10&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">16</span><span class="p">]:</span> <span class="n">df1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">);</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">17</span><span class="p">]:</span> <span class="n">df2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">);</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/overlay_example_intersection.png"><img alt="../../_images/overlay_example_intersection.png" src="../../_images/overlay_example_intersection.png" style="width: 5in;" /></a>
<p><code class="docutils literal notranslate"><span class="pre">how='symmetric_difference'</span></code> is the opposite of <code class="docutils literal notranslate"><span class="pre">'intersection'</span></code> and returns
the geometries that are only part of one of the GeoDataFrames but not of both:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">18</span><span class="p">]:</span> <span class="n">res_symdiff</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;symmetric_difference&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">19</span><span class="p">]:</span> <span class="n">res_symdiff</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">19</span><span class="p">]:</span> 
   <span class="n">df1</span>  <span class="n">df2</span>                                           <span class="n">geometry</span>
<span class="mi">0</span>  <span class="mf">1.0</span>  <span class="n">NaN</span>  <span class="n">POLYGON</span> <span class="p">((</span><span class="mf">0.000000000</span> <span class="mf">0.000000000</span><span class="p">,</span> <span class="mf">0.000000000</span><span class="o">...</span>
<span class="mi">1</span>  <span class="mf">2.0</span>  <span class="n">NaN</span>  <span class="n">MULTIPOLYGON</span> <span class="p">(((</span><span class="mf">2.000000000</span> <span class="mf">3.000000000</span><span class="p">,</span> <span class="mf">2.000</span><span class="o">...</span>
<span class="mi">2</span>  <span class="n">NaN</span>  <span class="mf">1.0</span>  <span class="n">MULTIPOLYGON</span> <span class="p">(((</span><span class="mf">1.000000000</span> <span class="mf">2.000000000</span><span class="p">,</span> <span class="mf">1.000</span><span class="o">...</span>
<span class="mi">3</span>  <span class="n">NaN</span>  <span class="mf">2.0</span>  <span class="n">POLYGON</span> <span class="p">((</span><span class="mf">3.000000000</span> <span class="mf">4.000000000</span><span class="p">,</span> <span class="mf">3.000000000</span><span class="o">...</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">20</span><span class="p">]:</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">res_symdiff</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;tab10&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">21</span><span class="p">]:</span> <span class="n">df1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">);</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">22</span><span class="p">]:</span> <span class="n">df2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">);</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/overlay_example_symdiff.png"><img alt="../../_images/overlay_example_symdiff.png" src="../../_images/overlay_example_symdiff.png" style="width: 5in;" /></a>
<p>To obtain the geometries that are part of <code class="docutils literal notranslate"><span class="pre">df1</span></code> but are not contained in
<code class="docutils literal notranslate"><span class="pre">df2</span></code>, you can use <code class="docutils literal notranslate"><span class="pre">how='difference'</span></code>:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">23</span><span class="p">]:</span> <span class="n">res_difference</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;difference&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">24</span><span class="p">]:</span> <span class="n">res_difference</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">24</span><span class="p">]:</span> 
                                            <span class="n">geometry</span>  <span class="n">df1</span>
<span class="mi">0</span>  <span class="n">POLYGON</span> <span class="p">((</span><span class="mf">0.000000000</span> <span class="mf">0.000000000</span><span class="p">,</span> <span class="mf">0.000000000</span><span class="o">...</span>    <span class="mi">1</span>
<span class="mi">1</span>  <span class="n">MULTIPOLYGON</span> <span class="p">(((</span><span class="mf">2.000000000</span> <span class="mf">3.000000000</span><span class="p">,</span> <span class="mf">2.000</span><span class="o">...</span>    <span class="mi">2</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">25</span><span class="p">]:</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">res_difference</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;tab10&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">26</span><span class="p">]:</span> <span class="n">df1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">);</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">27</span><span class="p">]:</span> <span class="n">df2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">);</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/overlay_example_difference.png"><img alt="../../_images/overlay_example_difference.png" src="../../_images/overlay_example_difference.png" style="width: 5in;" /></a>
<p>Finally, with <code class="docutils literal notranslate"><span class="pre">how='identity'</span></code>, the result consists of the surface of <code class="docutils literal notranslate"><span class="pre">df1</span></code>,
but with the geometries obtained from overlaying <code class="docutils literal notranslate"><span class="pre">df1</span></code> with <code class="docutils literal notranslate"><span class="pre">df2</span></code>:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">28</span><span class="p">]:</span> <span class="n">res_identity</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;identity&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">29</span><span class="p">]:</span> <span class="n">res_identity</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">29</span><span class="p">]:</span> 
   <span class="n">df1</span>  <span class="n">df2</span>                                           <span class="n">geometry</span>
<span class="mi">0</span>  <span class="mf">1.0</span>  <span class="mf">1.0</span>  <span class="n">POLYGON</span> <span class="p">((</span><span class="mf">1.000000000</span> <span class="mf">2.000000000</span><span class="p">,</span> <span class="mf">2.000000000</span><span class="o">...</span>
<span class="mi">1</span>  <span class="mf">2.0</span>  <span class="mf">1.0</span>  <span class="n">POLYGON</span> <span class="p">((</span><span class="mf">2.000000000</span> <span class="mf">2.000000000</span><span class="p">,</span> <span class="mf">2.000000000</span><span class="o">...</span>
<span class="mi">2</span>  <span class="mf">2.0</span>  <span class="mf">2.0</span>  <span class="n">POLYGON</span> <span class="p">((</span><span class="mf">3.000000000</span> <span class="mf">4.000000000</span><span class="p">,</span> <span class="mf">4.000000000</span><span class="o">...</span>
<span class="mi">3</span>  <span class="mf">1.0</span>  <span class="n">NaN</span>  <span class="n">POLYGON</span> <span class="p">((</span><span class="mf">0.000000000</span> <span class="mf">0.000000000</span><span class="p">,</span> <span class="mf">0.000000000</span><span class="o">...</span>
<span class="mi">4</span>  <span class="mf">2.0</span>  <span class="n">NaN</span>  <span class="n">MULTIPOLYGON</span> <span class="p">(((</span><span class="mf">2.000000000</span> <span class="mf">3.000000000</span><span class="p">,</span> <span class="mf">2.000</span><span class="o">...</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">30</span><span class="p">]:</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">res_identity</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;tab10&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">31</span><span class="p">]:</span> <span class="n">df1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">);</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">32</span><span class="p">]:</span> <span class="n">df2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">);</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/overlay_example_identity.png"><img alt="../../_images/overlay_example_identity.png" src="../../_images/overlay_example_identity.png" style="width: 5in;" /></a>
</div>
<div class="section" id="overlay-countries-example">
<h2>Overlay Countries Example<a class="headerlink" href="#overlay-countries-example" title="Permalink to this headline">¶</a></h2>
<p>First, we load the countries and cities example datasets and select :</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">33</span><span class="p">]:</span> <span class="n">world</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">geopandas</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="s1">&#39;naturalearth_lowres&#39;</span><span class="p">))</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">34</span><span class="p">]:</span> <span class="n">capitals</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">geopandas</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="s1">&#39;naturalearth_cities&#39;</span><span class="p">))</span>

<span class="c1"># Select South Amarica and some columns</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">35</span><span class="p">]:</span> <span class="n">countries</span> <span class="o">=</span> <span class="n">world</span><span class="p">[</span><span class="n">world</span><span class="p">[</span><span class="s1">&#39;continent&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;South America&quot;</span><span class="p">]</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">36</span><span class="p">]:</span> <span class="n">countries</span> <span class="o">=</span> <span class="n">countries</span><span class="p">[[</span><span class="s1">&#39;geometry&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">]]</span>

<span class="c1"># Project to crs that uses meters as distance measure</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">37</span><span class="p">]:</span> <span class="n">countries</span> <span class="o">=</span> <span class="n">countries</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s1">&#39;epsg:3395&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">38</span><span class="p">]:</span> <span class="n">capitals</span> <span class="o">=</span> <span class="n">capitals</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s1">&#39;epsg:3395&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>To illustrate the <code class="docutils literal notranslate"><span class="pre">overlay</span></code> function, consider the following case in which one
wishes to identify the “core” portion of each country – defined as areas within
500km of a capital – using a <code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code> of countries and a
<code class="docutils literal notranslate"><span class="pre">GeoDataFrame</span></code> of capitals.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at countries:</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">39</span><span class="p">]:</span> <span class="n">countries</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>

<span class="c1"># Now buffer cities to find area within 500km.</span>
<span class="c1"># Check CRS -- World Mercator, units of meters.</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">40</span><span class="p">]:</span> <span class="n">capitals</span><span class="o">.</span><span class="n">crs</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">40</span><span class="p">]:</span> 
<span class="o">&lt;</span><span class="n">Projected</span> <span class="n">CRS</span><span class="p">:</span> <span class="n">EPSG</span><span class="p">:</span><span class="mi">3395</span><span class="o">&gt;</span>
<span class="n">Name</span><span class="p">:</span> <span class="n">WGS</span> <span class="mi">84</span> <span class="o">/</span> <span class="n">World</span> <span class="n">Mercator</span>
<span class="n">Axis</span> <span class="n">Info</span> <span class="p">[</span><span class="n">cartesian</span><span class="p">]:</span>
<span class="o">-</span> <span class="n">E</span><span class="p">[</span><span class="n">east</span><span class="p">]:</span> <span class="n">Easting</span> <span class="p">(</span><span class="n">metre</span><span class="p">)</span>
<span class="o">-</span> <span class="n">N</span><span class="p">[</span><span class="n">north</span><span class="p">]:</span> <span class="n">Northing</span> <span class="p">(</span><span class="n">metre</span><span class="p">)</span>
<span class="n">Area</span> <span class="n">of</span> <span class="n">Use</span><span class="p">:</span>
<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">World</span> <span class="o">-</span> <span class="n">between</span> <span class="mi">80</span><span class="err">°</span><span class="n">S</span> <span class="ow">and</span> <span class="mi">84</span><span class="err">°</span><span class="n">N</span>
<span class="o">-</span> <span class="n">bounds</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">180.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">80.0</span><span class="p">,</span> <span class="mf">180.0</span><span class="p">,</span> <span class="mf">84.0</span><span class="p">)</span>
<span class="n">Coordinate</span> <span class="n">Operation</span><span class="p">:</span>
<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">World</span> <span class="n">Mercator</span>
<span class="o">-</span> <span class="n">method</span><span class="p">:</span> <span class="n">Mercator</span> <span class="p">(</span><span class="n">variant</span> <span class="n">A</span><span class="p">)</span>
<span class="n">Datum</span><span class="p">:</span> <span class="n">World</span> <span class="n">Geodetic</span> <span class="n">System</span> <span class="mi">1984</span>
<span class="o">-</span> <span class="n">Ellipsoid</span><span class="p">:</span> <span class="n">WGS</span> <span class="mi">84</span>
<span class="o">-</span> <span class="n">Prime</span> <span class="n">Meridian</span><span class="p">:</span> <span class="n">Greenwich</span>

<span class="c1"># make 500km buffer</span>
<span class="n">In</span> <span class="p">[</span><span class="mi">41</span><span class="p">]:</span> <span class="n">capitals</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">=</span> <span class="n">capitals</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mi">500000</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">42</span><span class="p">]:</span> <span class="n">capitals</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/world_basic.png"><img alt="../../_images/world_basic.png" src="../../_images/world_basic.png" style="width: 5in;" /></a>
<a class="reference internal image-reference" href="../../_images/capital_buffers.png"><img alt="../../_images/capital_buffers.png" src="../../_images/capital_buffers.png" style="width: 5in;" /></a>
<p>To select only the portion of countries within 500km of a capital, we specify the <code class="docutils literal notranslate"><span class="pre">how</span></code> option to be “intersect”, which creates a new set of polygons where these two layers overlap:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">43</span><span class="p">]:</span> <span class="n">country_cores</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="n">countries</span><span class="p">,</span> <span class="n">capitals</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;intersection&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">44</span><span class="p">]:</span> <span class="n">country_cores</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;tab10&#39;</span><span class="p">);</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/country_cores.png"><img alt="../../_images/country_cores.png" src="../../_images/country_cores.png" style="width: 5in;" /></a>
<p>Changing the “how” option allows for different types of overlay operations. For example, if we were interested in the portions of countries <em>far</em> from capitals (the peripheries), we would compute the difference of the two.</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="n">In</span> <span class="p">[</span><span class="mi">45</span><span class="p">]:</span> <span class="n">country_peripheries</span> <span class="o">=</span> <span class="n">geopandas</span><span class="o">.</span><span class="n">overlay</span><span class="p">(</span><span class="n">countries</span><span class="p">,</span> <span class="n">capitals</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;difference&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">46</span><span class="p">]:</span> <span class="n">country_peripheries</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;tab10&#39;</span><span class="p">);</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/country_peripheries.png"><img alt="../../_images/country_peripheries.png" src="../../_images/country_peripheries.png" style="width: 5in;" /></a>
</div>
<div class="section" id="keep-geom-type-keyword">
<h2>keep_geom_type keyword<a class="headerlink" href="#keep-geom-type-keyword" title="Permalink to this headline">¶</a></h2>
<p>In default settings, <code class="docutils literal notranslate"><span class="pre">overlay</span></code> returns only geometries of the same geometry type as df1
(left one) has, where Polygon and MultiPolygon is considered as a same type (other types likewise).
You can control this behavior using <code class="docutils literal notranslate"><span class="pre">keep_geom_type</span></code> option, which is set to
True by default. Once set to False, <code class="docutils literal notranslate"><span class="pre">overlay</span></code> will return all geometry types resulting from
selected set-operation. Different types can result for example from intersection of touching geometries,
where two polygons intersects in a line or a point.</p>
</div>
<div class="section" id="more-examples">
<h2>More Examples<a class="headerlink" href="#more-examples" title="Permalink to this headline">¶</a></h2>
<p>A larger set of examples of the use of <code class="docutils literal notranslate"><span class="pre">overlay</span></code> can be found <a class="reference external" href="http://nbviewer.jupyter.org/github/geopandas/geopandas/blob/master/examples/overlays.ipynb">here</a></p>
<div class="toctree-wrapper compound">
</div>
</div>
</div>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="geometric_manipulations.html" title="previous page">Geometric Manipulations</a>
    <a class='right-next' id="next-link" href="aggregation_with_dissolve.html" title="next page">Aggregation with dissolve</a>

              </div>
              
          </main>
          

      </div>
    </div>

    <script src="../../_static/js/index.js"></script>
    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2013–2019, GeoPandas developers.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>